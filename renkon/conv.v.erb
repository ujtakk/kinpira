% load "parameters.rb"

module conv(/*AUTOARG*/);
`include "parameters.vh"

  /*AUTOINPUT*/

  /*AUTOOUTPUT*/

  /*AUTOWIRE*/

  /*AUTOREG*/

  // AUTO_CONSTANT (DWIDTH)

  /* conv_tree AUTO_TEMPLATE (
      <%- for i in 0...($fsize**2) -%>
      .pixel<%=i%>  (pixel_in<%=i%>[DWIDTH-1:0]),
      <%- end -%>
      .fmap         (result[DWIDTH-1:0]),
  ); */
  conv_tree tree(/*AUTOINST*/);

  conv_wreg wreg(/*AUTOINST*/);

  /* mem_feat AUTO_TEMPLATE (
      .read_data1   (),
      .write_data1  (write_feat[DWIDTH-1:0]),
      .mem_we1      (mem_feat_we),
      .mem_addr1    (mem_feat_addr_d1[FACCUM-1:0]),
      .read_data2   (read_feat[DWIDTH-1:0]),
      .write_data2  ({DWIDTH{1'b0}}),
      .mem_we2      (1'b0),
      .mem_addr2    (mem_feat_addr[FACCUM-1:0]),
  ); */
  mem_feat mem_feat(/*AUTOINST*/);

  /* accumulator AUTO_TEMPLATE (
      .pixel_in (result[DWIDTH-1:0]),
      .reset    (mem_feat_rst),
      .sum_old  (read_feat[DWIDTH-1:0]),
      .sum_new  (write_feat[DWIDTH-1:0]),
  ); */
  accumulator feat_accum(/*AUTOINST*/);

endmodule
